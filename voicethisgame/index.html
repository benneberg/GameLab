<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microphone Test</title>
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; }
        button { font-size: 1.2em; padding: 10px 20px; cursor: pointer; }
        p { font-size: 0.9em; color: #555; margin-top: 20px; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Microphone Access Test ğŸ¤</h1>

    <button id="micButton">Request Microphone</button>

    <p id="status"></p>

    <p>For <strong>iPhone</strong> users, <strong>Safari</strong> requires user interaction to request microphone access. Ensure permissions are enabled in your settings if issues persist.</p>

    <script>
        const micButton = document.getElementById('micButton');
        const statusElement = document.getElementById('status');

        micButton.addEventListener('click', async () => {
            statusElement.textContent = 'Requesting microphone access...';
            statusElement.classList.remove('error');

            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    statusElement.textContent = 'Microphone access granted! âœ…';
                    // You can now use the stream (e.g., for recording or processing)
                    // To stop the microphone track (and turn off the indicator):
                    // stream.getTracks().forEach(track => track.stop());
                } catch (err) {
                    statusElement.classList.add('error');
                    if (err.name === 'NotAllowedError') {
                        statusElement.textContent = 'Microphone access denied by user. ğŸš«';
                    } else if (err.name === 'NotFoundError') {
                        statusElement.textContent = 'No microphone found. ğŸ¤â“';
                    } else if (err.name === 'NotReadableError') {
                        statusElement.textContent = 'Microphone is already in use or hardware error. ğŸ› ï¸';
                    } else {
                        statusElement.textContent = `Error accessing microphone: ${err.name} - ${err.message} âŒ`;
                    }
                    console.error('getUserMedia error:', err);
                    alert(`Debugging info: Failed to get microphone.\nError name: ${err.name}\nError message: ${err.message}`);
                }
            } else {
                statusElement.classList.add('error');
                statusElement.textContent = 'getUserMedia not supported in this browser. ğŸ‘';
                alert('Debugging info: navigator.mediaDevices.getUserMedia is not supported by your browser.');
            }
        });
    </script>

</body>
</html>
