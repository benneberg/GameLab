<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Audio Recorder</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2em; }
    button { padding: 0.6em 1.2em; margin: 0.5em; font-size: 1.1em; }
  </style>
</head>
<body>

  <h1>Record Game Sounds</h1>
  <p id="status">Tap the button below to begin.</p>
  <button id="startBtn">Enable Microphone</button>

  <div id="recordUI" style="display: none;">
    <div>
      <h3>Jump Sound</h3>
      <button onclick="startRecording('jump')">Start Recording</button>
      <button onclick="stopRecording()">Stop Recording</button>
      <button onclick="play('jump')">Play Jump</button>
    </div>
    <div>
      <h3>Slide Sound</h3>
      <button onclick="startRecording('slide')">Start Recording</button>
      <button onclick="stopRecording()">Stop Recording</button>
      <button onclick="play('slide')">Play Slide</button>
    </div>
  </div>

  <script>
    let stream;
    let mediaRecorder;
    let currentLabel = '';
    const sounds = {};

    // Function to determine supported MIME type
    function getSupportedMimeType() {
      const possibleTypes = [
        'audio/webm;codecs=opus',
        'audio/webm',
        'audio/ogg;codecs=opus',
        'audio/ogg',
        'audio/mp4',
        'audio/mpeg'
      ];
      for (const type of possibleTypes) {
        if (MediaRecorder.isTypeSupported(type)) {
          return type;
        }
      }
      return '';
    }

    document.getElementById("startBtn").addEventListener("click", () => {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(s => {
          stream = s;
          document.getElementById("recordUI").style.display = "block";
          document.getElementById("status").textContent = "Microphone ready!";
        })
        .catch(err => {
          console.error(err);
          document.getElementById("status").textContent = "Microphone access failed.";
        });
    });

    function startRecording(label) {
      if (!stream) return alert("Microphone not ready.");
      currentLabel = label;
      const chunks = [];

      const mimeType = getSupportedMimeType();
      if (!mimeType) {
        alert("No supported MIME type found for recording.");
        return;
      }

      try {
        mediaRecorder = new MediaRecorder(stream, { mimeType });
      } catch (e) {
        console.error("Exception while creating MediaRecorder:", e);
        alert("MediaRecorder is not supported with the selected MIME type.");
        return;
      }

      mediaRecorder.ondataavailable = e => chunks.push(e.data);
      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: mimeType });
        sounds[label] = URL.createObjectURL(blob);
        alert(`Recorded "${label}" sound.`);
      };

      mediaRecorder.start();
      console.log("Recording started:", label);
    }

    function stopRecording() {
      if (!mediaRecorder || mediaRecorder.state !== "recording") {
        alert("Nothing is being recorded.");
        return;
      }
      mediaRecorder.stop();
      console.log("Recording stopped:", currentLabel);
    }

    function play(label) {
      if (!sounds[label]) return alert(`No sound recorded for "${label}".`);
      const audio = new Audio(sounds[label]);
      audio.play().catch(err => {
        console.error("Playback failed:", err);
        alert("Playback failed.");
      });
    }
  </script>
</body>
</html>
